(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{56:function(e,t,a){e.exports=a(86)},62:function(e,t,a){},65:function(e,t,a){},72:function(e,t){},73:function(e,t){},74:function(e,t){},75:function(e,t){},76:function(e,t){},77:function(e,t){},78:function(e,t,a){},82:function(e,t,a){},85:function(e,t,a){},86:function(e,t,a){"use strict";a.r(t);var n=a(1),s=a.n(n),l=a(21),i=a.n(l),o=a(18),r=(a(61),a(62),a(6)),c=a(90),d=a(93),m=a(54),h=a(94);var p=class extends n.Component{render(){return this.props.show?s.a.createElement(h.a,{variant:this.props.variant||"danger",onClose:this.props.onClose,dismissible:!0},this.props.title&&s.a.createElement("h5",null,s.a.createElement("strong",null,this.props.title)),s.a.createElement("div",{dangerouslySetInnerHTML:{__html:this.props.message}})):null}};a(65);class u extends n.Component{render(){return s.a.createElement("div",{className:"About container"},s.a.createElement("h1",null,"About"),s.a.createElement("br",null),s.a.createElement("p",null,"Amazing web application that use magic algorithm that classify fresh and rotten fruits (sadly, it can only classify Apple, Banana, and Orange). Turns out it using Image Classification with TensorFlow.js! This app use our converted TensorFlow.js format CNN model to provide better experience when using this app as PWA and provide offline capabilities. You can use this app to decide which fruits is fresh or rotten and decide which fruit is apple, banana, or orange (in case you hit your head or something, LOL)",s.a.createElement("br",null),s.a.createElement("br",null)))}}var g=a(89),w=a(88),f=a(52),b=a(95),E=a(91),v=a(92),y=a(96),C=a(40),A=a(55),N=a(51),S=a.n(N),U=a(9),x=e=>{let{isLoading:t,text:a,loadingText:n,className:l="",disabled:i=!1,...o}=e;return s.a.createElement(w.a,Object.assign({className:"LoadButton ".concat(l),disabled:i||t},o),t&&s.a.createElement(g.a,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true"})," ",t?n:a)};const L={0:"Fresh Apple",1:"Fresh Banana",2:"Fresh Orange",3:"Rotten Apple",4:"Rotten Banana",5:"Rotten Orange"};var T={API_ENDPOINT:"http://localhost:5000/api"};a(78),a(79);const I="/model/model3/transfer_learning/model.json",M=150,k=224,O=3,W="tensorflowjs",P="model_info_store",F="web-model";class D extends n.Component{constructor(e){super(e),this.initWebcam=(async()=>{try{this.webcam=await U.b.webcam(this.refs.webcam,{resizeWidth:k,resizeHeight:k,facingMode:"environment"})}catch(e){this.refs.noWebcam.style.display="block"}}),this.startWebcam=(async()=>{this.webcam&&this.webcam.start()}),this.stopWebcam=(async()=>{this.webcam&&this.webcam.stop()}),this.getModelInfo=(async()=>{await fetch("".concat(T.API_ENDPOINT,"/model_info"),{method:"GET"}).then(async e=>{await e.json().then(e=>{this.modelLastUpdated=e.last_updated,console.log("".concat(T.API_ENDPOINT,"/model_info"))}).catch(e=>{console.log("Unable to get parse model info.")})}).catch(e=>{console.log("Unable to get model info")})}),this.updateModel=(async()=>{console.log("Updating the model: "+F),this.setState({isDownloadingModel:!0}),this.model=await U.d(I),await this.model.save("indexeddb://"+F),this.setState({isDownloadingModel:!1,modelUpdateAvailable:!1,showModelUpdateAlert:!1,showModelUpdateSuccess:!0})}),this.classifyLocalImage=(async()=>{this.setState({isClassifying:!0});const e=this.refs.cropper.getCroppedCanvas(),t=U.e(()=>U.a.fromPixels(e).toFloat()),a=await this.processImage(t),n=U.c.resizeBilinear(a,[M,M]),s=this.model.predict(n),l=await s.data(),i=await this.getTopKClasses(l,O);this.setState({predictions:i,isClassifying:!1,photoSettingsOpen:!this.state.photoSettingsOpen});const o=this.refs.canvas.getContext("2d"),r=k/e.width,c=k/e.height,d=Math.min(r,c);o.clearRect(0,0,k,k),o.drawImage(e,0,0,e.width*d,e.height*d),t.dispose(),a.dispose(),n.dispose(),s.dispose()}),this.classifyWebcamImage=(async()=>{this.setState({isClassifying:!0});const e=await this.webcam.capture(),t=U.c.resizeBilinear(e,[M,M]),a=await this.processImage(t),n=this.model.predict(a),s=await n.data(),l=await this.getTopKClasses(s,O);this.setState({predictions:l,isClassifying:!1,photoSettingsOpen:!this.state.photoSettingsOpen});const i=U.e(()=>e.toFloat().div(255));await U.a.toPixels(i,this.refs.canvas),t.dispose(),e.dispose(),a.dispose(),n.dispose(),i.dispose()}),this.processImage=(async e=>U.e(()=>e.expandDims(0).toFloat().div(127).sub(1))),this.getTopKClasses=(async(e,t)=>{const a=[];for(let i=0;i<e.length;i++)a.push({value:e[i],index:i});a.sort((e,t)=>t.value-e.value);const n=new Float32Array(t),s=new Int32Array(t);for(let i=0;i<t;i++)n[i]=a[i].value,s[i]=a[i].index;const l=[];for(let i=0;i<s.length;i++)l.push({className:L[s[i]],probability:(100*n[i]).toFixed(2)});return l}),this.handlePanelClick=(e=>{this.setState({photoSettingsOpen:!this.state.photoSettingsOpen})}),this.handleFileChange=(e=>{e.target.files&&e.target.files.length>0&&this.setState({file:URL.createObjectURL(e.target.files[0]),filename:e.target.files[0].name})}),this.handleTabSelect=(e=>{switch(e){case"camera":this.startWebcam();break;case"localfile":this.setState({filename:null,file:null}),this.stopWebcam()}}),this.webcam=null,this.model=null,this.modelLastUpdated=null,this.state={modelLoaded:!1,filename:"",isModelLoading:!1,isClassifying:!1,predictions:[],photoSettingsOpen:!0,modelUpdateAvailable:!1,showModelUpdateAlert:!1,showModelUpdateSuccess:!1,isDownloadingModel:!1}}async componentDidMount(){if("indexedDB"in window)try{this.model=await U.d("indexeddb://"+F);try{const t=await Object(A.a)(W,1),a=await t.transaction(P).objectStore(P).get(F),n=new Date(a.modelArtifactsInfo.dateSaved);await this.getModelInfo(),console.log(this.modelLastUpdated),!this.modelLastUpdated||n>=new Date(this.modelLastUpdated).getTime()?console.log("Using saved model"):this.setState({modelUpdateAvailable:!0,showModelUpdateAlert:!0})}catch(e){console.warn(e),console.warn("Could not retrieve when model was saved.")}}catch(e){console.log("Not found in IndexedDB. Loading and saving..."),console.log(e),this.model=await U.d(I),await this.model.save("indexeddb://"+F)}else console.warn("IndexedDB not supported."),this.model=await U.d(I);this.setState({modelLoaded:!0}),this.initWebcam(),U.e(()=>this.model.predict(U.f([1,M,M,3]))).dispose()}async componentWillUnmount(){this.webcam&&this.webcam.stop();try{this.model.dispose()}catch(e){}}render(){return s.a.createElement("div",{className:"Classify container"},!this.state.modelLoaded&&s.a.createElement(n.Fragment,null,s.a.createElement(g.a,{animation:"border",role:"status"},s.a.createElement("span",{className:"sr-only"},"Loading..."))," ",s.a.createElement("span",{className:"loading-model-text"},"Loading Model"),s.a.createElement("h6",null,"Please wait patiently, for the first time it will take a little bit longer")),this.state.modelLoaded&&s.a.createElement(n.Fragment,null,s.a.createElement(w.a,{onClick:this.handlePanelClick,className:"classify-panel-header","aria-controls":"photo-selection-pane","aria-expanded":this.state.photoSettingsOpen},"Take or Select a Photo to Classify",s.a.createElement("span",{className:"panel-arrow"},this.state.photoSettingsOpen?s.a.createElement(C.b,null):s.a.createElement(C.c,null))),s.a.createElement(f.a,{in:this.state.photoSettingsOpen},s.a.createElement("div",{id:"photo-selection-pane"},this.state.modelUpdateAvailable&&this.state.showModelUpdateAlert&&s.a.createElement(c.a,null,s.a.createElement(h.a,{variant:"info",show:this.state.modelUpdateAvailable&&this.state.showModelUpdateAlert,onClose:()=>this.setState({showModelUpdateAlert:!1}),dismissible:!0},"An update for the ",s.a.createElement("strong",null,this.state.modelType)," model is available.",s.a.createElement("div",{className:"d-flex justify-content-center pt-1"},!this.state.isDownloadingModel&&s.a.createElement(w.a,{onClick:this.updateModel,variant:"outline-info"},"Update"),this.state.isDownloadingModel&&s.a.createElement("div",null,s.a.createElement(g.a,{animation:"border",role:"status",size:"sm"},s.a.createElement("span",{className:"sr-only"},"Downloading..."))," ",s.a.createElement("strong",null,"Downloading..."))))),this.state.showModelUpdateSuccess&&s.a.createElement(c.a,null,s.a.createElement(h.a,{variant:"success",onClose:()=>this.setState({showModelUpdateSuccess:!1}),dismissible:!0},"The ",s.a.createElement("strong",null,this.state.modelType)," model has been updated!")),s.a.createElement(b.a,{defaultActiveKey:"camera",id:"input-options",onSelect:this.handleTabSelect,className:"justify-content-center"},s.a.createElement(E.a,{eventKey:"camera",title:"Take Photo"},s.a.createElement("div",{id:"no-webcam",ref:"noWebcam"},s.a.createElement("span",{className:"camera-icon"},s.a.createElement(C.a,null)),"No camera found. ",s.a.createElement("br",null),"Please use a device with a camera, or upload an image instead."),s.a.createElement("div",{className:"webcam-box-outer"},s.a.createElement("div",{className:"webcam-box-inner"},s.a.createElement("video",{ref:"webcam",autoPlay:!0,playsInline:!0,muted:!0,id:"webcam",width:"448",height:"448"}))),s.a.createElement("div",{className:"button-container"},s.a.createElement(x,{variant:"primary",size:"lg",onClick:this.classifyWebcamImage,isLoading:this.state.isClassifying,text:"Let's Classify!",loadingText:"Classifying..."}))),s.a.createElement(E.a,{eventKey:"localfile",title:"Select Image From Local"},s.a.createElement(v.a.Group,{controlId:"file"},s.a.createElement(v.a.Label,null,"Upload your image"),s.a.createElement("br",null),s.a.createElement(v.a.Label,{className:"imagelabel"},this.state.filename?this.state.filename:"Browse"),s.a.createElement(v.a.Control,{onChange:this.handleFileChange,type:"file",accept:"image/*",className:"imagefile"})),this.state.file&&s.a.createElement(n.Fragment,null,s.a.createElement("div",{id:"local-image"},s.a.createElement(S.a,{ref:"cropper",src:this.state.file,style:{height:400,width:"100%"},guides:!0,aspectRatio:1,viewMode:2})),s.a.createElement("div",{className:"button-container"},s.a.createElement(x,{variant:"primary",size:"lg",disabled:!this.state.filename,onClick:this.classifyLocalImage,isLoading:this.state.isClassifying,text:"Let's Classify!",loadingText:"Classifying..."}))))))),this.state.predictions.length>0&&s.a.createElement("div",{className:"classification-results"},s.a.createElement("h3",null,"Predictions"),s.a.createElement("canvas",{ref:"canvas",width:k,height:k}),s.a.createElement("br",null),s.a.createElement(y.a,null,this.state.predictions.map(e=>(console.log(e),"Fresh Apple"===e.className||"Fresh Orange"===e.className||"Fresh Banana"===e.className?s.a.createElement("div",null,s.a.createElement("p",null,"This most likely ",s.a.createElement("strong",null,e.className)," with ",e.probability,"% probability!"),s.a.createElement("p",null,"You can eat it safely!")):s.a.createElement("div",null,s.a.createElement("p",null,"Oh no! This is ",s.a.createElement("strong",null,e.className)," with ",e.probability,"% probability!"),s.a.createElement("p",null,"You shouldn't eat it!"))))))))}}a(82);var j=()=>s.a.createElement("div",{className:"NotFound"},s.a.createElement("h1",null,"404"),s.a.createElement("h3",null,"The page you were looking for is not here."),s.a.createElement("a",{href:"/"},"Go Home"));var B=e=>{let{childProps:t}=e;return s.a.createElement(o.b,null,s.a.createElement(r.c,null,s.a.createElement(r.a,{path:"/",exact:!0,component:D,props:t}),s.a.createElement(r.a,{path:"/about",exact:!0,component:u,props:t}),s.a.createElement(r.a,{component:j})))};a(85);var _=Object(r.f)(class extends n.Component{constructor(e){super(e),this.dismissUpdateAlert=(e=>{this.setState({showUpdateAlert:!1})}),this.state={showUpdateAlert:!0,reloadMsg:"\n      New content is available.<br />\n      Please <a href='javascript:location.reload();'>reload</a>.<br />\n      <small>If reloading doesn't work, close all tabs/windows of this web application,\n      and then reopen the application.</small>\n    "}}render(){return s.a.createElement("div",{className:"App"},s.a.createElement(c.a,null,s.a.createElement(d.a,{collapseOnSelect:!0,className:"app-nav-bar",variant:"dark",expand:"lg"},s.a.createElement(d.a.Brand,{href:"/"},"What's Fresh & What's Rotten?"),s.a.createElement(d.a.Toggle,{"aria-controls":"basic-navbar-nav"}),s.a.createElement(d.a.Collapse,{id:"basic-navbar-nav"},s.a.createElement(m.a,null,s.a.createElement(o.c,{className:"nav-link",to:"/"},"Let's Classify!"),s.a.createElement(o.c,{className:"nav-link",to:"/about"},"About")))),this.props.updateAvailable&&this.state.showUpdateAlert&&s.a.createElement("div",{style:{paddingTop:"10px"}},s.a.createElement(p,{title:"",variant:"info",message:this.state.reloadMsg,show:this.props.updateAvailable&&this.state.showUpdateAlert,onClose:this.dismissUpdateAlert}))),s.a.createElement(c.a,null,s.a.createElement(B,null)))}});const R=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function z(e){if("serviceWorker"in navigator){if(new URL("/fruit-rotten-detection",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",()=>{const t="".concat("/fruit-rotten-detection","/service-worker.js");R?(!function(e,t){fetch(e).then(a=>{const n=a.headers.get("content-type");404===a.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then(e=>{e.unregister().then(()=>{window.location.reload()})}):K(e,t)}).catch(()=>{console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(()=>{console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")})):K(t,e)})}}function K(e,t){navigator.serviceWorker.register(e).then(e=>{function a(a){console.log("New content is available and will be used when all tabs for this page are closed. See http://bit.ly/CRA2-PWA."),t&&t.onUpdate&&t.onUpdate(e,a)}e.waiting&&e.active&&a(e.waiting),e.onupdatefound=(()=>{const n=e.installing;null!=n&&(n.onstatechange=(()=>{"installed"===n.state&&(navigator.serviceWorker.controller?a(n):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))}))})}).catch(e=>{console.error("Error during service worker registration:",e)})}class G extends n.Component{constructor(){super(...arguments),this.state={contentCached:!1,updateAvailable:!1},this.handleUpdate=(e=>{const t=e.waiting;t&&t.postMessage({type:"SKIP_WAITING"}),this.setState({updateAvailable:!0})})}componentDidMount(){z({onUpdate:this.handleUpdate})}render(){return s.a.createElement(o.a,null,s.a.createElement(_,{updateAvailable:this.state.updateAvailable}))}}i.a.render(s.a.createElement(G,null),document.getElementById("root"))}},[[56,1,2]]]);
//# sourceMappingURL=main.14d917a7.chunk.js.map